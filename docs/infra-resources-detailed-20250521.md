# ğŸ“¦ iN é¡¹ç›®åŸºç¡€è®¾æ–½èµ„æºè¯¦è§£ (æ¶æ„ç‰ˆæœ¬ 2025å¹´5æœˆ21æ—¥)

> æœ¬æ–‡æ¡£è¯¦ç»†è®°å½• iN é¡¹ç›®åœ¨ Vercelã€Cloudflare å’Œ Google Cloud Platform (GCP) ä¸‰ä¸ªå¹³å°ä½¿ç”¨çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½èµ„æºï¼Œå¹¶æåŠ GitHub ä½œä¸ºä»£ç ç®¡ç†å’Œ CI/CD å·¥å…·ã€‚æ‰€æœ‰èµ„æºçš„ç›®æ ‡æ˜¯å°½é‡åˆ©ç”¨å„æœåŠ¡å•†çš„æ°¸ä¹…å…è´¹é¢åº¦ã€‚æœ¬æ–‡æ¡£å–ä»£äº†ä»»ä½•ç‹¬ç«‹çš„æ‘˜è¦å¼èµ„æºæ¸…å•ã€‚

---
## æ¦‚è§ˆ
æœ¬é¡¹ç›®é‡‡ç”¨å¤šäº‘æ¶æ„ï¼Œå„å¹³å°èŒè´£å¦‚ä¸‹ï¼š
- **Vercel**: æ‰˜ç®¡å’Œéƒ¨ç½²å‰ç«¯ç”¨æˆ·ç•Œé¢ã€‚
- **Cloudflare**: æä¾›è¾¹ç¼˜ç½‘ç»œæœåŠ¡ã€APIç½‘å…³ã€åˆ†å¸ƒå¼çŠ¶æ€åè°ƒåŠéƒ¨åˆ†è¾¹ç¼˜ä¼˜åŒ–å­˜å‚¨ã€‚
- **Google Cloud Platform (GCP)**: ä½œä¸ºæ ¸å¿ƒåç«¯æœåŠ¡å¹³å°ï¼Œæä¾›ç”¨æˆ·è®¤è¯ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ ¸å¿ƒè®¡ç®—èƒ½åŠ›ã€æ•°æ®åº“ä»¥åŠé›†ä¸­æ—¥å¿—ç›‘æ§ã€‚
- **GitHub**: ä»£ç ç‰ˆæœ¬æ§åˆ¶ä¸CI/CDè‡ªåŠ¨åŒ–ã€‚
---

## ğŸ¨ Vercel èµ„æºæ¸…å• (å‰ç«¯å±•ç¤ºå¹³å°)

| ç±»å‹       | åç§°ç¤ºä¾‹ (æ¦‚å¿µæ€§)          | è¯´æ˜                                                                 |
| ---------- | -------------------------- | -------------------------------------------------------------------- |
| é¡¹ç›®åç§°   | `in-frontend`              | Vercel ä¸Šçš„å‰ç«¯é¡¹ç›®ï¼Œä¾‹å¦‚ä½¿ç”¨ SvelteKit/Next.js æ„å»ºçš„ç”¨æˆ·ç•Œé¢ã€‚         |
| éƒ¨ç½²åˆ†æ”¯   | `main`, `dev`, `feature/*` | è‡ªåŠ¨ä» GitHub ä»“åº“çš„ç›¸åº”åˆ†æ”¯éƒ¨ç½²åˆ° Vercel çš„ Production, Preview ç¯å¢ƒã€‚ |
| ç¯å¢ƒå˜é‡   | `NEXT_PUBLIC_API_GATEWAY_URL`, `NEXT_PUBLIC_GCIP_CONFIG_PARAMS` ç­‰ | ç”¨äºå‰ç«¯åº”ç”¨è¿æ¥åç«¯APIå’Œè®¤è¯æœåŠ¡ã€‚é€šè¿‡ Vercel é¡¹ç›®è®¾ç½®ç®¡ç†ã€‚             |
| Hobby Plan | N/A                        | åˆ©ç”¨ Vercel çš„å…è´¹ Hobby Plan æä¾›çš„æ„å»ºã€éƒ¨ç½²ã€CDN å’Œå¸¦å®½ã€‚            |

---

## â˜ï¸ Cloudflare èµ„æºæ¸…å• (è¾¹ç¼˜ç½‘ç»œã€APIç½‘å…³ã€çŠ¶æ€åè°ƒä¸è¾¹ç¼˜å­˜å‚¨)

| ç±»å‹             | åç§°ç¤ºä¾‹ (æ ¹æ® `naming-conventions-*.md`) | è¯´æ˜                                                                  |
| ---------------- | --------------------------------------- | --------------------------------------------------------------------- |
| Workers          | `in-worker-api-gateway-prod`            | API ç½‘å…³ï¼Œå¤„ç†æ‰€æœ‰å…¥ç«™APIè¯·æ±‚ï¼Œè·¯ç”±ï¼Œè®¤è¯é¢„å¤„ç†ã€‚                         |
|                  | (å…¶ä»–è½»é‡çº§è¾¹ç¼˜é€»è¾‘Worker)                  | ä¾‹å¦‚ï¼Œè‡ªå®šä¹‰Headerå¤„ç†ï¼Œç®€å•çš„è¯·æ±‚è½¬æ¢ç­‰ã€‚                               |
| Durable Object   | `in-do-task-coordinator-prod`           | ä»»åŠ¡çŠ¶æ€åè°ƒå™¨ï¼Œç®¡ç†æ¯ä¸ªä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ã€‚                               |
| R2 Bucket        | `in-r2-images-prod`                   | å­˜å‚¨å›¾åƒåŸå›¾ã€å¤„ç†ç»“æœã€‚               |
| D1 æ•°æ®åº“        | `in-d1-main-db-prod`                  | å­˜å‚¨ç»“æ„åŒ–å…ƒæ•°æ®ã€ä»»åŠ¡è®°å½•çš„æ‘˜è¦ç­‰ï¼Œé€‚åˆè¾¹ç¼˜è®¿é—®ã€‚                      |
| Vectorize Index  | `in-vectorize-image-embeddings-prod`  | å­˜å‚¨å›¾åƒå‘é‡åµŒå…¥ï¼Œæ”¯æŒç›¸ä¼¼æ€§æœç´¢ã€‚                               |
| KV å‘½åç©ºé—´ (å¯é€‰) | `in-kv-config-cache-prod`             | ç”¨äºç¼“å­˜å°‘é‡é…ç½®æ•°æ®æˆ–å®ç°ç®€å•çš„å¿«é€ŸæŸ¥æ‰¾ã€‚                                   |
| Secrets Store    | å„ Worker ç»‘å®šä¸“å±å¯†é’¥                  | å­˜å‚¨è®¿é—®GCPæœåŠ¡æ‰€éœ€çš„APIå¯†é’¥ï¼ˆé€šè¿‡å¼•ç”¨ç¯å¢ƒå˜é‡ï¼‰ã€HMACå¯†é’¥ç­‰ã€‚                               |
| Logpush (é…ç½®)   | `in-logpush-gcp-logging-prod`           | é…ç½® Cloudflare Logpush å°†æ—¥å¿—å¯¼å‡ºåˆ° GCP (ä¾‹å¦‚é€šè¿‡ Pub/Sub ä¸­è½¬åˆ° Cloud Logging)ã€‚ |

---

## ğŸš€ Google Cloud Platform (GCP) èµ„æºæ¸…å• (æ ¸å¿ƒåç«¯æœåŠ¡)

| ç±»å‹                             | åç§°ç¤ºä¾‹ (æ¦‚å¿µæ€§ï¼Œå«ç¯å¢ƒ)                      | è¯´æ˜                                                                                                |
| -------------------------------- | --------------------------------------------- | --------------------------------------------------------------------------------------------------- |
| é¡¹ç›® ID                          | `in-project-prod-a1b2`                        | GCP ä¸»é¡¹ç›®æ ‡è¯†ã€‚                                                                                      |
| **Identity Platform (GCIP)** | (é¡¹ç›®å†…å¯ç”¨é…ç½®)                                | ç”¨æˆ·èº«ä»½è®¤è¯å’Œç®¡ç†ï¼Œæ”¯æŒ OAuth (Google/GitHub ç­‰) å’Œå…¶ä»–ç™»å½•æ–¹å¼ã€‚                                       |
| **Pub/Sub** |                                               |                                                                                                     |
| &nbsp;&nbsp;ä¸»é¢˜ (Topics)         | `in-ps-new-task-requests-prod`                | ç”¨äºæ¥æ”¶æ–°ä»»åŠ¡æ¶ˆæ¯ã€‚                                                                                    |
|                                  | `in-ps-download-requests-prod`                | ä¼ é€’ä¸‹è½½è¯·æ±‚ã€‚                                                                                        |
|                                  | `in-ps-metadata-requests-prod`                | ä¼ é€’å…ƒæ•°æ®æå–è¯·æ±‚ã€‚                                                                                    |
|                                  | `in-ps-ai-requests-prod`                      | ä¼ é€’AIå¤„ç†è¯·æ±‚ã€‚                                                                                      |
| &nbsp;&nbsp;è®¢é˜… (Subscriptions) | `in-ps-sub-download-func-prod`                | ä¸‹è½½æœåŠ¡çš„ Cloud Function/Run è®¢é˜…æ­¤ï¼Œä»¥è·å–ä¸‹è½½ä»»åŠ¡ã€‚                                                   |
|                                  | (ä¸ºæ¯ä¸ªå¤„ç†é˜¶æ®µçš„ä¸»é¢˜åˆ›å»ºå¯¹åº”è®¢é˜…ï¼Œå«ç¯å¢ƒåç¼€)    | ...                                                                                                 |
| &nbsp;&nbsp;æ­»ä¿¡ä¸»é¢˜ (DLT)       | `in-ps-dlt-download-requests-prod`            | å­˜å‚¨ä¸‹è½½è¯·æ±‚å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ã€‚                                                                                |
| **Cloud Functions / Cloud Run** | `in-func-download-image-prod`                 | Serverless å‡½æ•°æˆ–å®¹å™¨æœåŠ¡ï¼Œè®¢é˜… Pub/Sub ä¸»é¢˜ï¼Œæ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆä¸‹è½½ã€å…ƒæ•°æ®ã€AIï¼‰ã€‚                          |
|                                  | `in-func-metadata-processor-prod`             | ...                                                                                                 |
|                                  | `in-svc-ai-processor-prod` (Cloud Run)        | ...                                                                                                 |
| **Firestore (Native Mode)** | `in-fs-main-prod` (æ•°æ®åº“ID)                    | NoSQL æ–‡æ¡£æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·é…ç½®ã€åº”ç”¨è®¾ç½®ã€éƒ¨åˆ†ä»»åŠ¡å…ƒæ•°æ®å’ŒçŠ¶æ€çš„æŒä¹…åŒ–ï¼ˆä½œä¸ºD1çš„è¡¥å……æˆ–æ›¿ä»£ï¼‰ã€‚ |
| &nbsp;&nbsp;é›†åˆ (Collections)   | `user-preferences`, `task-details`            | Firestore å†…çš„æ•°æ®é›†åˆã€‚                                                                              |
| **Cloud Storage (GCS) (å¯é€‰)** | `in-gcs-images-prod`                          | å¯¹è±¡å­˜å‚¨ï¼Œå¯ä½œä¸º R2 çš„è¡¥å……/æ›¿ä»£ï¼Œæˆ–å½“è®¡ç®—åœ¨GCPæ—¶ä½œä¸ºä¸»è¦å­˜å‚¨ã€‚                                              |
| **Vertex AI Vector Search (å¯é€‰)**| `in-vxai-idx-images-prod`                     | å¦‚æœéœ€è¦æ›´é«˜çº§çš„å‘é‡æœç´¢åŠŸèƒ½ï¼Œå¯æ›¿ä»£ Cloudflare Vectorizeã€‚                                              |
| **Cloud Logging & Monitoring** | (é¡¹ç›®å†…é»˜è®¤å¯ç”¨å’Œé…ç½®)                          | æ”¶é›†ã€åˆ†æå’Œå¯è§†åŒ–æ¥è‡ªæ‰€æœ‰GCPæœåŠ¡ä»¥åŠé€šè¿‡Cloudflare Logpushå¯¼å…¥çš„æ—¥å¿—å’Œç›‘æ§æ•°æ®ã€‚                         |
| &nbsp;&nbsp;æ—¥å¿—æ¥æ”¶å™¨ (Sinks)   | `in-logsink-cflogs-to-pubsub-prod`            | ...                                                                                                 |
| &nbsp;&nbsp;ä»ªè¡¨ç›˜ä¸å‘Šè­¦        | `in-dashboard-main-prod`, `in-alert-errors-prod`| ç›‘æ§å…³é”®ä¸šåŠ¡æŒ‡æ ‡å’Œç³»ç»Ÿå¥åº·åº¦ã€‚                                                                            |
| **Service Accounts & IAM** | `sa-in-compute@in-project-prod-a1b2.iam.gserviceaccount.com` | æœåŠ¡è´¦å·ï¼Œç”¨äºæˆæƒ Cloudflare Workers (æˆ–å…¶ä»–æœåŠ¡) è®¿é—®GCPèµ„æº (å¦‚Pub/Sub, Firestore)ã€‚IAM ç­–ç•¥å®šä¹‰æƒé™ã€‚ |
| **Secret Manager & API å¯†é’¥** | (é€šè¿‡ Secret Manager ç®¡ç†)                    | ç”¨äº GCP æœåŠ¡é—´æˆ–å¤–éƒ¨åº”ç”¨è®¿é—® GCP API çš„å¯†é’¥ã€‚Cloudflare Worker ä¸­ä½¿ç”¨çš„ GCP å‡­è¯ä¹Ÿåº”å¼•ç”¨æ­¤å¤„ç®¡ç†çš„å¯†é’¥ã€‚ |

---

## GITHUB"> GitHub èµ„æºæ¸…å• (ä»£ç ç®¡ç†ä¸ CI/CD)

| ç±»å‹            | åç§°ç¤ºä¾‹                               | è¯´æ˜                                                                    |
| --------------- | -------------------------------------- | ----------------------------------------------------------------------- |
| Repository      | `your-username/in-project`             | GitHub ä¸Šçš„ä¸»ä»£ç ä»“åº“ï¼Œé‡‡ç”¨ Monorepo ç»“æ„ã€‚                               |
| GitHub Actions  | `.github/workflows/deploy-prod.yml`    | CI/CD å·¥ä½œæµï¼Œå®šä¹‰è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ„å»ºã€éƒ¨ç½²åˆ° Vercel, Cloudflare, GCPçš„æµç¨‹ã€‚ |
|                 | `.github/workflows/ci-dev.yml`         | å¼€å‘/é¢„è§ˆç¯å¢ƒCI/CDå·¥ä½œæµã€‚                                                 |
| Secrets         | `GCP_SA_KEY_TERRAFORM_PROD`, `CF_API_TOKEN_PROD`, `VERCEL_TOKEN_PROD` | åœ¨ GitHub Actions ä¸­ä½¿ç”¨çš„ã€åŒºåˆ†ç¯å¢ƒçš„æ•æ„Ÿå‡­è¯ï¼Œç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚      |

---

## ğŸ“š ç®¡ç†æ–¹å¼

- Cloudflare å’Œ GCP èµ„æºä¸»è¦ç”± **Terraform** (ä½äº `infra/` ç›®å½•) ç®¡ç†ã€‚ä½¿ç”¨ Terraform Workspaces ç®¡ç†ä¸åŒç¯å¢ƒ (prod, stg, dev)ã€‚
- Vercel é¡¹ç›®é€šè¿‡ Vercel æ§åˆ¶å°ä¸ GitHub ä»“åº“ç»‘å®šï¼Œé…ç½®é€šè¿‡ Vercel UI å’Œç¯å¢ƒå˜é‡ç®¡ç† (ä¹Ÿå¯é€šè¿‡ Vercel Terraform Provider ç®¡ç†éƒ¨åˆ†é…ç½®)ã€‚
- æ‰€æœ‰æ•æ„Ÿé…ç½®ä¿¡æ¯ï¼ˆAPIå¯†é’¥ã€æœåŠ¡è´¦å·å¯†é’¥ç­‰ï¼‰é€šè¿‡å„å¹³å°çš„ Secrets Management (Cloudflare Secrets, GCP Secret Manager, Vercel Environment Variables, GitHub Actions Secrets) è¿›è¡Œå®‰å…¨ç®¡ç†ï¼Œç¦æ­¢ç¡¬ç¼–ç åˆ°ä»£ç æˆ– Terraform é…ç½®ä¸­ã€‚è„šæœ¬ (`tools/`) å¯èƒ½ç”¨äºè¾…åŠ©éæ•æ„Ÿé…ç½®çš„åŒæ­¥æˆ–ç‰¹å®šä»»åŠ¡ã€‚

---

## ğŸ”’ å®‰å…¨è¯´æ˜ (æ‘˜è¦)

- **è®¤è¯**: ç”¨æˆ·è®¤è¯ç”± GCP Identity Platform å¤„ç†ã€‚æœåŠ¡é—´è®¤è¯é‡‡ç”¨ GCP æœåŠ¡è´¦å·ã€‚
- **æˆæƒ**: Cloudflare å’Œ GCP å‡ä½¿ç”¨å„è‡ªçš„ IAM ç³»ç»Ÿã€‚
- **å¯†é’¥ç®¡ç†**: ä¸¥æ ¼ä½¿ç”¨å„å¹³å°æä¾›çš„ Secrets Management æœåŠ¡åŠ GitHub Actions Secretsã€‚
- **ç½‘ç»œå®‰å…¨**: Cloudflare æä¾›è¾¹ç¼˜å®‰å…¨ã€‚GCP é€šè¿‡ VPC å’Œé˜²ç«å¢™è§„åˆ™æ§åˆ¶ã€‚
- **æ—¥å¿—å®¡è®¡**: æ‰€æœ‰æ—¥å¿—é›†ä¸­åˆ° Google Cloud Loggingã€‚

è¯¦ç»†å®‰å…¨å®è·µè¯·å‚è§ `secure-practices-*.md`ã€‚